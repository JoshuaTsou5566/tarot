<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¤§é˜¿çˆ¾å…‹ç´ - éˆæ€§æŒ‡å¼•</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700&family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Noto Sans TC', sans-serif; 
            margin: 0; 
            padding: 0; 
            overflow-x: hidden; 
            -webkit-tap-highlight-color: transparent;
            background-color: #020617;
            transition: background-color 0.8s ease;
        }
        .font-serif { font-family: 'Noto Serif TC', serif; }
        ::-webkit-scrollbar { display: none; }
        
        .animate-fade-up { animation: fadeUp 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; opacity: 0; }
        @keyframes fadeUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .card-shuffle { animation: shuffleEffect 0.7s infinite alternate ease-in-out; }
        @keyframes shuffleEffect {
            0% { transform: translate(0, 0) rotate(0deg) scale(1); }
            100% { transform: translate(10px, -15px) rotate(5deg) scale(1.05); }
        }

        .glass { backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .no-select { user-select: none; -webkit-user-select: none; }
        
        .stars-container {
            position: fixed;
            inset: 0;
            z-index: -1;
            pointer-events: none;
        }
        .star {
            position: absolute; background: white; border-radius: 50%; opacity: 0.2;
            animation: twinkle var(--duration) infinite ease-in-out;
        }
        @keyframes twinkle {
            0%, 100% { opacity: 0.1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.3); }
        }

        .btn-active:active { transform: scale(0.95); transition: 0.1s; }
        input::placeholder { opacity: 0.4; }
        
        .modal-overlay { background: rgba(0, 0, 0, 0.8); backdrop-filter: blur(8px); }

        /* ç‰¹è£½çš„é«˜äº®è¿”å›æŒ‰éˆ• */
        .btn-return-classic {
            background: linear-gradient(135deg, #ffffff 0%, #f1f5f9 100%);
            color: #0f172a;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.2), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
            border: 2px solid #334155;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- SVG åœ–æ¨™ ---
        const ICONS = {
            Sparkles: <><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4M19 17v4M3 5h4M17 19h4"/></>,
            History: <><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M12 7v5l4 2"/></>,
            Book: <><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1-0.5-5"/><path d="M6.5 17H20"/></>,
            Moon: <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/>,
            Sun: <><circle cx="12" cy="12" r="4"/><path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"/></>,
            Lock: <><rect width="18" height="11" x="3" y="11" rx="2" ry="2" /><path d="M7 11V7a5 5 0 0 1 10 0v4" /></>,
            Refresh: <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8M21 3v5h-5M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16M3 21v-5h5"/>,
            Chevron: <polyline points="6 9 12 15 18 9" />,
            X: <><line x1="18" y1="6" x2="6" y2="18" /><line x1="6" y1="6" x2="18" y2="18" /></>,
            Share: <><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/><polyline points="16 6 12 2 8 6"/><line x1="12" y1="2" x2="12" y2="15"/></>,
            ChiikawaHead: <path d="M12 22C6.5 22 2 17.5 2 12C2 8.5 4.5 5.5 8 4.5V2A1.5 1.5 0 0 1 11 2v2c.3-.1.6-.1.9-.1s.7 0 1 .1V2a1.5 1.5 0 0 1 3 0v2.5c3.5 1 6 4 6 7.5 0 5.5-4.5 10-10 10z" fill="currentColor" />,
            HachiwareHead: <path d="M12 22c-5.5 0-10-4.5-10-10 0-3.5 2.5-6.5 6-7.5L6 1l3-1 2 2.5c.3-.1.7-.2 1-.2s.7.1 1 .2L15 0l3 1-2 2.5c3.5 1 6 4 6 7.5 0 5.5-4.5 10-10 10z" fill="currentColor" />,
            UsagiHead: <path d="M12 22c-5.5 0-10-4.5-10-10 0-3.5 2-6.5 5-7.5V0a1.5 1.5 0 0 1 3 0v3.2c.6-.1 1.3-.2 2-.2s1.4.1 2 .2V0a1.5 1.5 0 0 1 3 0v3.5c3 1 5 4 5 7.5 0 5.5-4.5 10-10 10z" fill="currentColor" />,
            Save: <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2zM17 21v-8H7v8M7 3v5h8"/>,
            LogOut: <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4M16 17l5-5-5-5M21 12H9"/>
        };

        const TAROT_DATA = [
            { id: 0, numeral: "0", title: "æ„šè€…", meaning: "ç´”çœŸèˆ‡é–‹ç«¯", keywords: ["å†’éšª", "è‡ªç”±", "å‹‡æ°£", "ç„¡é™å¯èƒ½"], love: ["æ–°æˆ€æƒ…çš„é–‹ç«¯ï¼Œç´”ç²¹ä¸”ç„¡æ‹˜ç„¡æŸã€‚", "éæ–¼é­¯è½ï¼Œå°é—œä¿‚ç¼ºä¹æ‰¿è«¾ã€‚"], social: ["çµäº¤æ–°æœ‹å‹ï¼Œæ°£æ°›è¼•é¬†æ„‰å¿«ã€‚", "å®¹æ˜“è¢«è¦–ç‚ºä¸é è­œæˆ–éæ–¼ä»»æ€§ã€‚"], work: ["é©åˆè½‰è·æˆ–é–‹ç™¼æ–°å‰µæ„ï¼Œå……æ»¿ç†±æƒ…ã€‚", "ç¼ºä¹ç´€å¾‹èˆ‡è¨ˆç•«ï¼Œå®¹æ˜“å‡ºéŒ¯ã€‚"], finance: ["å°é‡‘éŒ¢æŠ±æŒæ¨‚è§€ï¼Œå¯èƒ½æœ‰æ„å¤–é–‹éŠ·ã€‚", "è²¡å‹™ç‹€æ³ä¸ç©©å®šï¼Œéœ€é˜²ç¯„éåº¦æ¶ˆè²»ã€‚"] },
            { id: 1, numeral: "I", title: "é­”è¡“å¸«", meaning: "å‰µé€ åŠ›èˆ‡æŒæ¡", keywords: ["å‰µæ„", "æŒæ¡", "æƒ³åƒåŠ›", "è³‡æº"], love: ["å……æ»¿å¸å¼•åŠ›çš„é–‹ç«¯ï¼Œæºé€šé †æš¢ã€‚", "ç”œè¨€èœœèªèƒŒå¾Œçš„è™›å½ï¼Œç¼ºä¹çœŸå¿ƒã€‚"], social: ["å±•ç¾å€‹äººæ‰è¯ï¼Œæˆç‚ºåœ˜é«”æ ¸å¿ƒã€‚", "å¯èƒ½çµ¦äººæ²¹è…”æ»‘èª¿ã€ä¸èª å¯¦çš„å°è±¡ã€‚"], work: ["å…·å‚™è§£æ±ºå•é¡Œçš„èƒ½åŠ›ï¼Œè¨ˆç•«é †åˆ©æ¨é€²ã€‚", "æŠ€è¡“ä¸æˆç†Ÿæˆ–èƒ½åŠ›ä¸è¶³å»ç¡¬æ’ã€‚"], finance: ["æœ‰èƒ½åŠ›å‰µé€ è²¡å¯Œï¼Œå–„æ–¼ç†è²¡è¦åŠƒã€‚", "æŠ•è³‡é™·é˜±æˆ–è²¡å‹™è³‡è¨Šä¸å°ç¨±ã€‚"] },
            { id: 2, numeral: "II", title: "å¥³ç¥­å¸", meaning: "ç›´è¦ºèˆ‡å¯§éœ", keywords: ["æ™ºæ…§", "ç¥ç¥•", "æ½›æ„è­˜", "å…§çœ"], love: ["éˆé­‚å±¤é¢çš„å¥‘åˆï¼Œéœå¾…ç™¼å±•ã€‚", "æƒ…ç·’å£“æŠ‘ï¼Œé—œä¿‚ä¸­å­˜åœ¨éš”é–¡ã€‚"], social: ["è¢«è¦–ç‚ºæ˜æ™ºã€å†·éœçš„å‚¾è½è€…ã€‚", "éæ–¼å­¤åƒ»æˆ–ç¥ç¥•ï¼Œè®“äººé›£ä»¥æ¥è¿‘ã€‚"], work: ["æ†‘ç›´è¦ºåšå‡ºæ­£ç¢ºæ±ºç­–ï¼Œé©åˆç ”ç©¶ã€‚", "å¿½è¦–ç´°ç¯€æˆ–éæ–¼æ„Ÿæƒ…ç”¨äº‹ã€‚"], finance: ["ä¿å®ˆç†è²¡ï¼Œè²¡å‹™ç‹€æ³å¹³ç©©ã€‚", "ç†è²¡è³‡è¨Šæ¨¡ç³Šï¼Œå­˜åœ¨éš±è—è™§æã€‚"] },
            { id: 3, numeral: "III", title: "çš‡å", meaning: "è±é¥’èˆ‡æ„›", keywords: ["è±ç››", "ç¾æ„Ÿ", "äº«æ¨‚", "æ¯æ€§"], love: ["æ„Ÿæƒ…ç”œèœœã€è±æ”¶ï¼Œå¯èƒ½è¿ä¾†æ–°ç”Ÿå‘½ã€‚", "æƒ…æ„Ÿéœ€æ±‚éå¤§ï¼Œç”¢ç”Ÿä¾è³´æˆ–æ§åˆ¶æ„Ÿã€‚"], social: ["æ°£æ°›å’Œè«§ï¼Œå……æ»¿å¥³æ€§åŠ›é‡çš„é—œæ‡·ã€‚", "éæ–¼å˜®å¨æˆ–å¹²æ¶‰ä»–äººç§ç”Ÿæ´»ã€‚"], work: ["å‰µæ„æ³‰æ¹§ï¼Œç’°å¢ƒå……æ»¿åŒ…å®¹åŠ›ã€‚", "é€²åº¦åœæ»¯ä¸å‰ï¼Œéæ–¼è¿½æ±‚å®‰é€¸ã€‚"], finance: ["è²¡é‹æ¥µä½³ï¼Œäº«å—å„ªæ¸¥ç”Ÿæ´»ã€‚", "æ®éœç„¡åº¦ï¼Œå…¥ä¸æ•·å‡ºã€‚"] },
            { id: 4, numeral: "IV", title: "çš‡å¸", meaning: "æ¬Šå¨èˆ‡ç§©åº", keywords: ["ç©©å®š", "è¦ç¯„", "çˆ¶æ¬Š", "å …å®š"], love: ["é—œä¿‚ç©©å®šï¼Œçµ¦äºˆå°æ–¹æ¥µå¤§çš„å®‰å…¨æ„Ÿã€‚", "å°ˆåˆ¶éœ¸é“ï¼Œç¼ºä¹æƒ…æ„Ÿäº¤æµèˆ‡æŸ”è»Ÿã€‚"], social: ["æ“”ä»»é ˜å°è€…è§’è‰²ï¼Œå—äººæ™¯ä»°ã€‚", "æ¬ŠåŠ›é¬¥çˆ­æˆ–éæ–¼åƒµåŒ–ã€é›£ç›¸è™•ã€‚"], work: ["å»ºç«‹ç³»çµ±ï¼Œäº‹æ¥­æ ¹åŸºç©©å›ºã€‚", "ç®¡ç†å¤±æ•—ï¼Œè¨ˆç•«è¢«åƒµåŒ–çš„è¦å‰‡æŸç¸›ã€‚"], finance: ["ç©©å®šæ”¶å…¥ï¼Œå°ˆæ¥­çš„ç†è²¡æ¶æ§‹ã€‚", "éæ–¼ä¿å®ˆæˆ–å› æ§åˆ¶æ¬²å°è‡´è²¡å‹™æå¤±ã€‚"] },
            { id: 5, numeral: "V", title: "æ•™çš‡", meaning: "å‚³çµ±èˆ‡æ™ºæ…§", keywords: ["æ•™å°", "æ´åŠ©", "ä¿¡ä»°", "å°å¸«"], love: ["é‡è¦–æ‰¿è«¾ï¼Œé©åˆæ­¥å…¥å©šå§»æˆ–ç©©å®šé—œä¿‚ã€‚", "è§€å¿µåˆ†æ­§ï¼Œè¢«ç¤¾æœƒè¦ç¯„æŸç¸›çš„å£“æŠ‘ã€‚"], social: ["å°‹æ±‚é•·è¼©æˆ–å°å¸«çš„æŒ‡å¼•ï¼Œå—æƒ è‰¯å¤šã€‚", "å®¹æ˜“å› è§€å¿µä¿å®ˆèˆ‡äººç™¼ç”Ÿå£è§’ã€‚"], work: ["éµå¾ªå°ˆæ¥­æµç¨‹ï¼Œç²å¾—å‰è¼©ææ‹”ã€‚", "æ’æ–¥å‰µæ–°ï¼Œè¨ˆç•«éæ–¼è€èˆŠç„¡åŠ›ã€‚"], finance: ["ä¿¡è­½è‰¯å¥½ï¼Œé©åˆç©©å¥é•·æœŸæŠ•è³‡ã€‚", "è²¡å‹™ç³¾ç´›ï¼Œéœ€å°å¿ƒä¿¡è¨—åˆç´„å•é¡Œã€‚"] },
            { id: 6, numeral: "VI", title: "æˆ€äºº", meaning: "é¸æ“‡èˆ‡å¥‘åˆ", keywords: ["çµåˆ", "å¸å¼•åŠ›", "å’Œè«§", "äº¤è"], love: ["å®Œç¾å’Œè«§çš„æ„›æƒ…ï¼Œåšå‡ºæ­£ç¢ºçš„çµåˆã€‚", "é¢è‡¨é¸æ“‡å›°é›£ï¼Œæ„Ÿæƒ…ä¸­å‡ºç¾ç¬¬ä¸‰è€…èª˜æƒ‘ã€‚"], social: ["å»ºç«‹æ·±åšçš„å‹èª¼ï¼Œåˆä½œç„¡é–“ã€‚", "åƒ¹å€¼è§€è¡çªï¼Œå®¹æ˜“ç™¼ç”Ÿçˆ­åµã€‚"], work: ["é©åˆåˆå¤¥æˆ–åœ˜éšŠå”ä½œï¼Œç›®æ¨™ä¸€è‡´ã€‚", "æ±ºç­–çŒ¶è±«ï¼Œåœ˜éšŠå…§éƒ¨ç”¢ç”Ÿå«Œéš™ã€‚"], finance: ["æ­£ç¢ºçš„æŠ•è³‡æ±ºç­–ï¼Œè²¡é‹å¹³é †ã€‚", "å› æƒ…æ„Ÿå› ç´ å°è‡´ä¸æ™ºçš„è²¡å‹™æ±ºå®šã€‚"] },
            { id: 7, numeral: "VII", title: "æˆ°è»Š", meaning: "æ„å¿—èˆ‡å‹åˆ©", keywords: ["æ„å¿—", "è¡åˆº", "å…‹æœ", "æŒæ§"], love: ["ç©æ¥µä¸»å‹•ï¼ŒæˆåŠŸå…‹æœæƒ…æ„Ÿä¸Šçš„éšœç¤™ã€‚", "æƒ…ç·’å¤±æ§ï¼Œé—œä¿‚ä¸­å‡ºç¾æ¿€çƒˆçš„çˆ­åŸ·ã€‚"], social: ["æ¥µå…·å€‹äººé­…åŠ›ï¼Œå¸¶é ˜åœ˜éšŠå‰é€²ã€‚", "å‰›æ„è‡ªç”¨ï¼Œå®¹æ˜“æ‹›è‡´ä»–äººçš„åæ„Ÿã€‚"], work: ["æ„å¿—å …å®šï¼Œäº‹æ¥­å–å¾—é‡å¤§çªç ´ã€‚", "ç›®æ¨™è¿·å¤±ï¼Œå› ç„¦èºè€Œå°è‡´è¨ˆç•«å¤±æ•—ã€‚"], finance: ["ç©æ¥µé–‹æºï¼Œç›®æ¨™æ˜ç¢ºæ”¶ç›Šå¢é•·ã€‚", "æ”¶æ”¯å¤±è¡¡ï¼Œå› é­¯è²Œæ“´å¼µè€Œè² å‚µã€‚"] },
            { id: 8, numeral: "VIII", title: "åŠ›é‡", meaning: "å‹‡æ°£èˆ‡æ…ˆæ‚²", keywords: ["éŸŒæ€§", "ä¸å±ˆ", "é¦´æœ", "æº«å’Œ"], love: ["ä»¥æŸ”å…‹å‰›ï¼ŒæˆåŠŸå°å¼•å°æ–¹çš„æƒ…ç·’ã€‚", "ä¿¡å¿ƒå‹•æ–ï¼Œæ„Ÿåˆ°ç„¡åŠ›ç¶­æŒé€™æ®µé—œä¿‚ã€‚"], social: ["å¾…äººçœŸèª ï¼Œæ“æœ‰å¼·å¤§çš„è¦ªå’ŒåŠ›ã€‚", "å®¹æ˜“å—ä»–äººæƒ…ç·’å‹’ç´¢è€Œæ„Ÿåˆ°ç–²æ†Šã€‚"], work: ["ä¸ç•æŒ‘æˆ°ï¼Œä»¥è€æ€§åŒ–è§£å±æ©Ÿã€‚", "èƒ½åŠ›å—é™ï¼Œé¢å°å£“åŠ›æ™‚é¡¯å¾—è»Ÿå¼±ã€‚"], finance: ["é‡å…¥ç‚ºå‡ºï¼Œæ“æœ‰è‰¯å¥½çš„è²¡å‹™è‡ªåˆ¶åŠ›ã€‚", "è²¡å‹™å¤±æ§ï¼Œè¢«æ…¾æœ›ç‰½è‘—é¼»å­èµ°ã€‚"] },
            { id: 9, numeral: "IX", title: "éš±è€…", meaning: "å…§çœèˆ‡æ™ºæ…§", keywords: ["æ¢ç´¢", "å­¤ç¨", "å¼•å°", "å¿ƒéˆ"], love: ["äº«å—ç¨è™•ï¼Œæˆ–èˆ‡ä¼´ä¾¶é€²è¡Œæ·±åº¦å¿ƒéˆå°è©±ã€‚", "éåº¦å­¤ç«‹ï¼Œæ‹’çµ•å°å¤–æºé€šè€Œç”¢ç”Ÿéš”é–¡ã€‚"], social: ["æ·¡æ³Šç¤¾äº¤ï¼Œå°ˆæ³¨æ–¼å…§åœ¨çš„æˆé•·ã€‚", "è¢«é‚Šç·£åŒ–æˆ–æ„Ÿåˆ°å¯‚å¯ï¼Œæ‹’çµ•ç¤¾äº¤ã€‚"], work: ["æ·±è€•å°ˆæ¥­é ˜åŸŸï¼Œæ™ºæ…§å°‡å¸¶ä¾†æˆåŠŸã€‚", "é€²åº¦é²ç·©ï¼Œéæ–¼å°ˆæ³¨ç´°ç¯€è€Œå¿½ç•¥å¤§å±€ã€‚"], finance: ["æ·¡æ¬²ç†è²¡ï¼Œè²¡å‹™ç‹€æ³å°šå¯ã€‚", "éæ–¼å°æ°£æˆ–å› å°é–‰è³‡è¨ŠéŒ¯å¤±å•†æ©Ÿã€‚"] },
            { id: 10, numeral: "X", title: "å‘½é‹ä¹‹è¼ª", meaning: "é€±æœŸèˆ‡è½‰æ©Ÿ", keywords: ["è½‰æŠ˜", "è¼ªè¿´", "é€±æœŸ", "å¥‘æ©Ÿ"], love: ["å‘½é‹çš„å®‰æ’ï¼Œé—œä¿‚è¿ä¾†æ­£å‘è½‰æŠ˜ã€‚", "é‹æ°£ä¸ä½³ï¼Œæƒ…æ„Ÿé€²å…¥åœæ»¯çš„ä½æ½®æœŸã€‚"], social: ["ç¤¾äº¤åœˆæ›´è¿­ï¼Œè¿ä¾†æœ‰åŠ©ç›Šçš„æ–°æœ‹å‹ã€‚", "äººéš›é—œä¿‚åè¦†ç„¡å¸¸ï¼Œé›£ä»¥æ‰æ‘¸ã€‚"], work: ["æ™‚ä¾†é‹è½‰ï¼ŒæŒæ¡é—œéµçš„æ™‰å‡æ©Ÿæœƒã€‚", "é˜»ç¤™é‡é‡ï¼Œç¾ç‹€é›£ä»¥è¢«è‡ªå·±æŒæ§ã€‚"], finance: ["è²¡é‹å›å‡ï¼Œæœ‰æ„å¤–çš„ä¸­çæ©Ÿæœƒã€‚", "æŠ•è³‡è™§æï¼Œè²¡å‹™é€±æœŸé™·å…¥ä¸é †ã€‚"] },
            { id: 11, numeral: "XI", title: "æ­£ç¾©", meaning: "å…¬å¹³èˆ‡å¹³è¡¡", keywords: ["å¹³è¡¡", "è£æ±º", "çœŸç›¸", "è²¬ä»»"], love: ["èª å¯¦å°å¾…å½¼æ­¤ï¼Œåšå‡ºå…¬å¹³çš„æ±ºç­–ã€‚", "é¢è‡¨å†·æˆ°ï¼Œé—œä¿‚ä¸­å­˜åœ¨æ˜é¡¯çš„ä¸å¹³ç­‰ã€‚"], social: ["è™•äº‹å…¬æ­£ï¼Œæˆç‚ºæœ‹å‹é–“çš„èª¿è§£äººã€‚", "é­å—åè¦‹æˆ–èª¤è§£ï¼Œæ„Ÿåˆ°å§”å±ˆã€‚"], work: ["ä¸€åˆ‡ç…§åˆ¶åº¦åŸ·è¡Œï¼Œç²å¾—æ‡‰æœ‰çš„å›é¥‹ã€‚", "æ±ºç­–å¤±æº–ï¼Œéœ€æ‰¿æ“”éå»éŒ¯èª¤çš„å¾Œå­¸ã€‚"], finance: ["è²¡å‹™å¹³è¡¡ï¼Œæ”¶æ”¯å¸³ç›®æ¸…æ™°ã€‚", "è²¡å‹™çˆ­è­°ï¼Œå¯èƒ½é¢è‡¨å®˜å¸æˆ–åˆç´„å•é¡Œã€‚"] },
            { id: 12, numeral: "XII", title: "å€’åŠäºº", meaning: "çŠ§ç‰²èˆ‡è¦ºé†’", keywords: ["ç­‰å¾…", "å¥‰ç»", "æ–°è¦–è§’", "æš«ç·©"], love: ["æ›ä½æ€è€ƒï¼Œåœ¨ç­‰å¾…ä¸­ç²å¾—æƒ…æ„Ÿæ˜‡è¯ã€‚", "å¾’å‹ç„¡åŠŸçš„çŠ§ç‰²ï¼Œè¢«å‹•æ¥å—ç—›è‹¦ã€‚"], social: ["å¯§é¡˜åƒè™§ä¹Ÿè¦æˆå°±å¤§å±€çš„æ…·æ…¨ã€‚", "æ„Ÿåˆ°è¢«å‘¨åœçš„äººåˆ©ç”¨ï¼Œå…§å¿ƒæŠ‘é¬±ã€‚"], work: ["æš«æ™‚çš„æ²‰å¯‚æ˜¯ç‚ºäº†è“„ç©æ›´å¤§çš„èƒ½é‡ã€‚", "è¨ˆç•«åœæ»¯ï¼Œåšå†å¤šä¹Ÿçœ‹ä¸åˆ°å›å ±ã€‚"], finance: ["è²¡å‹™ç·©æ…¢ç™¼å±•ï¼Œéœ€ä¿æŒè€å¿ƒã€‚", "è³‡é‡‘å‡çµï¼Œå› åˆ¤æ–·å°è‡´è²¡å‹™å›°å¢ƒã€‚"] },
            { id: 13, numeral: "XIII", title: "æ­»ç¥", meaning: "çµ‚çµèˆ‡æ–°ç”Ÿ", keywords: ["å‘Šåˆ¥", "é‡å•Ÿ", "å¤§è®Šå‹•", "é‡ç”Ÿ"], love: ["å¾¹åº•å‘Šåˆ¥éå»ï¼Œè¿æ¥å…¨æ–°çš„æˆ€æ„›è§€ã€‚", "æ­»å®ˆä¸€æ®µæœ‰å®³çš„é—œä¿‚ï¼Œæ‹’çµ•æ”¹è®Šã€‚"], social: ["äººéš›åœˆå¤§æ´—ç‰Œï¼Œé‡æ–°å¯©è¦–æœ‹å‹åœˆã€‚", "å°ç¤¾äº¤æ„Ÿåˆ°çµ•æœ›ï¼Œå…§å¿ƒå……æ»¿é™°å½±ã€‚"], work: ["èˆŠè¨ˆç•«çµ‚çµï¼Œäº‹æ¥­è¿ä¾†é‡å¤§è½‰æ©Ÿã€‚", "è¢«è¿«è½‰è·æˆ–å€’é–‰ï¼Œå…§å¿ƒæ¥µåº¦ä¸å®‰ã€‚"], finance: ["çµç®—èˆŠå¸³ï¼Œé‡æ–°è¦åŠƒç†è²¡æ–¹å‘ã€‚", "è²¡å‹™å´©æ½°ï¼Œçªå¦‚å…¶ä¾†çš„åš´é‡è™§æã€‚"] },
            { id: 14, numeral: "XIV", title: "ç¯€åˆ¶", meaning: "å¹³è¡¡èˆ‡èª¿å’Œ", keywords: ["è€å¿ƒ", "èª¿å’Œ", "æºé€š", "åœ“è"], love: ["å¿ƒéˆäº¤æµé †æš¢ï¼Œæƒ…æ„Ÿæº«å’Œä¸”é•·ä¹…ã€‚", "æºé€šå¤±éˆï¼Œæƒ…ç·’èµ·ä¼éå¤§å½±éŸ¿é—œä¿‚ã€‚"], social: ["äººéš›é—œä¿‚åœ“èï¼Œå–„æ–¼æ•´åˆè³‡æºã€‚", "é »ç‡ä¸å°ï¼Œèˆ‡å‘¨é­çš„äººæ ¼æ ¼ä¸å…¥ã€‚"], work: ["å”ä½œé †åˆ©ï¼Œäº‹ç‰©æ­£ç©©å®šæˆé•·ã€‚", "è³‡æºæµªè²»ï¼Œå„éƒ¨é–€ä¹‹é–“ç¼ºä¹é»˜å¥‘ã€‚"], finance: ["ç©©å¥ç†è²¡ï¼Œè²¡å¯Œç©©å®šç´¯ç©ä¸­ã€‚", "é–‹æ”¯æ··ç·´ï¼Œç„¡æ³•é”åˆ°æ”¶æ”¯å¹³è¡¡ã€‚"] },
            { id: 15, numeral: "XV", title: "æƒ¡é­”", meaning: "æ…¾æœ›èˆ‡æŸç¸›", keywords: ["èª˜æƒ‘", "ç‰©æ…¾", "æ²ˆæºº", "é™°æš—é¢"], love: ["å¼·çƒˆå¸å¼•åŠ›ï¼Œä½†ä¼´éš¨è‘—è‚‰æ…¾èˆ‡åˆ¶ç´„ã€‚", "æ„è­˜åˆ°é—œä¿‚çš„æœ‰å®³ï¼Œæ­£å°‹æ±‚è§£è„«ã€‚"], social: ["æ²ˆæººæ–¼ç©æ¨‚ç¤¾äº¤ï¼Œå®¹æ˜“è¢«å¸¶å£ã€‚", "çœ‹ç©¿ä»–äººçš„è™›å½ï¼Œé é›¢ä¸å¥åº·çš„ç¤¾äº¤ã€‚"], work: ["å°æ¬ŠåŠ›æœ‰æ¥µå¤§åŸ·å¿µï¼Œå¯èƒ½æ¡å–æ¥µç«¯æ‰‹æ³•ã€‚", "å¾ç¹é‡çš„å·¥ä½œå£“åŠ›ä¸­ç²å¾—é‡‹æ”¾ã€‚"], finance: ["è²¡å¯Œæ…¾æœ›å¼·å¤§ï¼Œå¯èƒ½æœƒæœ‰æ©«è²¡ã€‚", "é™·å…¥è²¡å‹™é™·é˜±æˆ–å‚µå‹™æ³¥æ²¼ã€‚"] },
            { id: 16, numeral: "XVI", title: "å¡”", meaning: "åŠ‡è®Šèˆ‡å•Ÿç¤º", keywords: ["å´©è§£", "è¡æ“Š", "éœ‡æ’¼", "é‡èµ·"], love: ["æ„Ÿæƒ…ç™¼ç”ŸåŠ‡çƒˆè¡æ“Šï¼ŒçœŸç›¸å¤§ç™½ã€‚", "åƒ¥å€–é€ƒéä¸€åŠ«ï¼Œä½†é—œä¿‚å·²å‡ºç¾è£‚ç—•ã€‚"], social: ["æœ‹å‹åœˆç™¼ç”Ÿé‡å¤§çˆ­åŸ·ï¼Œé—œä¿‚å´©è§£ã€‚", "ç·©æ…¢çš„è¡°æ•—ï¼Œæ„Ÿè¦ºæœ‹å‹é–“æ¼¸è¡Œæ¼¸é ã€‚"], work: ["è¨ˆç•«çªç„¶å‘Šå¹ï¼Œå¿…é ˆå¾å»¢å¢Ÿé‡èµ·ã€‚", "æ„è­˜åˆ°å±æ©Ÿå­˜åœ¨ï¼Œéœ€ç«‹å³èª¿æ•´é˜²ç¦¦ã€‚"], finance: ["çªå¦‚å…¶ä¾†çš„ç ´ç”¢æˆ–é‡å¤§æå¤±ã€‚", "å‹‰å¼·ç¶­æŒå¹³è¡¡ï¼Œä½†å·²æ˜¯å¼·å¼©ä¹‹æœ«ã€‚"] },
            { id: 17, numeral: "XVII", title: "æ˜Ÿæ˜Ÿ", meaning: "å¸Œæœ›èˆ‡ç™‚ç™’", keywords: ["éˆæ„Ÿ", "å±•æœ›", "æ²»ç™’", "å¹³éœ"], love: ["å……æ»¿æœªä¾†çš„æ†§æ†¬ï¼Œæ„Ÿæƒ…å¾—åˆ°æ²»ç™’ã€‚", "é¡˜æ™¯ç ´è£‚ï¼Œå°æ„›æƒ…æ„Ÿåˆ°å¤±æœ›èˆ‡è©•æ†Šã€‚"], social: ["å±•ç¾çœŸå¯¦è‡ªæˆ‘ï¼Œå¸å¼•å¿—åŒé“åˆè€…ã€‚", "æ„Ÿåˆ°å­¤å‚²æˆ–è¢«å¤–ç•Œå¿½è¦–ï¼Œå¤±å»å…‰èŠ’ã€‚"], work: ["éˆæ„Ÿè±æ²›ï¼Œæ‰¾åˆ°é•·é ç™¼å±•çš„æ–¹å‘ã€‚", "è¨ˆç•«ä¸åˆ‡å¯¦éš›ï¼Œæ·ªç‚ºç©ºè«‡ã€‚"], finance: ["è²¡é‹å¹³é †ï¼Œç†è²¡æ–¹å‘å……æ»¿å¸Œæœ›ã€‚", "è²¡å‹™é¡˜æ™¯é™ä¸å¯åŠï¼Œéœ€å›æ­¸ç¾å¯¦ã€‚"] },
            { id: 18, numeral: "XVIII", title: "æœˆäº®", meaning: "ä¸å®‰èˆ‡æ½›æ„è­˜", keywords: ["ç„¦æ…®", "æ¨¡ç³Š", "å¤¢å¢ƒ", "æ¬ºç"], love: ["æƒ…æ„Ÿæ¨¡ç³Šä¸æ¸…ï¼Œå­˜åœ¨éš±çæˆ–å¹»è¦ºã€‚", "è¿·éœ§æ•£å»ï¼Œçœ‹æ¸…äº†æ„Ÿæƒ…ä¸­çš„çœŸç›¸ã€‚"], social: ["å°äººä½œç¥Ÿï¼Œäººéš›é—œä¿‚å……æ»¿çŒœå¿Œã€‚", "å…§å¿ƒçš„ç„¦æ…®æ¸›å¯«ï¼Œä¸å†ç–‘ç¥ç–‘é¬¼ã€‚"], work: ["è³‡è¨Šä¸æ˜ï¼Œéœ€è­¦æƒ•éš±è—çš„é™·é˜±ã€‚", "è§£æ±ºäº†å·¥ä½œä¸­çš„æ›–æ˜§åœ°å¸¶ã€‚"], finance: ["è²¡å‹™ç‹€æ³æ¨¡ç³Šï¼Œä¸å®œé€²è¡ŒæŠ•è³‡ã€‚", "ç™¼ç¾å¸³ç›®ä¸Šçš„æ¼æ´æˆ–æ¬ºè©ã€‚"] },
            { id: 19, numeral: "XIX", title: "å¤ªé™½", meaning: "å…‰æ˜èˆ‡æˆåŠŸ", keywords: ["å–œæ‚…", "æ´»åŠ›", "æˆåŠŸ", "å…‰æ˜"], love: ["æˆ€æƒ…å…¬é–‹å—ç¥ç¦ï¼Œé—œä¿‚å……æ»¿æ´»åŠ›ã€‚", "éæ–¼è‡ªè² ï¼Œå…‰èŠ’åˆºçœ¼è®“ä¼´ä¾¶æ„Ÿåˆ°å£“æŠ‘ã€‚"], social: ["å»£å—æ­¡è¿ï¼Œäººéš›é—œä¿‚ç‡¦çˆ›å¥ªç›®ã€‚", "ç‚ºäº†é¢å­è€Œå¼·é¡æ­¡ç¬‘ï¼Œå…§å¿ƒç–²ç´¯ã€‚"], work: ["äº‹æ¥­å¦‚æ—¥ä¸­å¤©ï¼Œç²å¾—é¡¯è‘—çš„æˆå°±æ„Ÿã€‚", "æˆåŠŸå¾Œçš„å€¦æ€ ï¼Œæˆ–é­é‡çŸ­æš«çš„æŒ«æ•—ã€‚"], finance: ["æ”¶å…¥è±åšï¼Œè²¡é‹æ—ºç››ä¸”ç©©å®šã€‚", "æš«æ™‚æ€§çš„è²¡å‹™åƒç·Šï¼Œéœ€é–‹ç¯€ç´„æµã€‚"] },
            { id: 20, numeral: "XX", title: "å¯©åˆ¤", meaning: "å¾©æ´»èˆ‡æ„Ÿå¬", keywords: ["è¦ºé†’", "åçœ", "å†ç”Ÿ", "æ±ºå®š"], love: ["ç ´é¡é‡åœ“ï¼Œæˆ–é—œä¿‚å‡ç´šåˆ°æ–°é«˜åº¦ã€‚", "é‡è¹ˆè¦†è½ï¼Œæ‹’çµ•é¢å°éå»ã€‚"], social: ["é€éè‡ªæˆ‘åçœï¼Œæ”¹å–„äº†èˆ‡äººçš„é—œä¿‚ã€‚", "é­å—è¼¿è«–æ‰¹è©•æˆ–ä»–äººçš„è² é¢æŒ‡é»ã€‚"], work: ["ç²çŸ¥é—œéµæ¶ˆæ¯ï¼Œäº‹æ¥­ç²å¾—æ–°ç”Ÿæ©Ÿæœƒã€‚", "éŒ¯å¸«è‰¯æ©Ÿï¼Œç„¡æ³•å¾éå»çš„å¤±æ•—ä¸­å­¸ç¿’ã€‚"], finance: ["è²¡å‹™ç‹€æ³çµç®—ï¼Œç²å¾—æ­£å‘æœå¯¦ã€‚", "è²¡å‹™å¯©è¨ˆå‡ºå•é¡Œï¼Œéœ€æ‰¿æ“”éå»å¾Œæœã€‚"] },
            { id: 21, numeral: "XXI", title: "ä¸–ç•Œ", meaning: "åœ“æ»¿èˆ‡æ•´åˆ", keywords: ["åœ“æ»¿", "æ•´åˆ", "å®Œç¾", "é”æˆ"], love: ["éˆé­‚ä¼´ä¾¶ï¼Œæƒ…æ„Ÿç”Ÿæ´»é”åˆ°å®Œç¾å¢ƒåœ°ã€‚", "å·®ä¸€é»é»å°±åœ“æ»¿ï¼Œå­˜åœ¨æœªç«Ÿä¹‹å¿—ã€‚"], social: ["æ“æœ‰å»£é—Šçš„äººè„ˆï¼Œç¤¾äº¤ç„¡å¾€ä¸åˆ©ã€‚", "äººéš›åœˆé›–ç„¶å¤§ï¼Œä½†æ„Ÿåˆ°å¿ƒéˆç©ºè™›ã€‚"], work: ["è¨ˆç•«åœ“æ»¿é”æˆï¼Œè´å¾—æ¥­ç•Œæ¥µé«˜è²è­½ã€‚", "é€²åº¦å³å°‡å®Œæˆæœ€å¾Œé—œé ­ç”¢ç”Ÿæ‹–å»¶ã€‚"], finance: ["è²¡å¯Œé”åˆ°é æœŸç›®æ¨™ï¼Œè²¡å‹™è‡ªç”±ã€‚", "è²¡å¯Œç´¯ç©å—é˜»ï¼Œç„¡æ³•çªç ´æœ€å¾Œç“¶é ¸ã€‚"] }
        ];

        const CHIIKAWA_IMAGES = Array.from({length: 22}).reduce((acc, _, i) => {
            acc[i] = `https://raw.githubusercontent.com/JoshuaTsou5566/tarot/refs/heads/main/${i}.jpg`;
            return acc;
        }, {});

        // --- å­çµ„ä»¶ ---
        const Icon = ({ name, size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {ICONS[name]}
            </svg>
        );

        const StarField = () => {
            const stars = useMemo(() => Array.from({length: 40}).map((_, i) => ({
                id: i,
                top: `${Math.random() * 100}%`,
                left: `${Math.random() * 100}%`,
                size: `${Math.random() * 2 + 1}px`,
                duration: `${Math.random() * 3 + 2}s`,
                delay: `${Math.random() * 5}s`
            })), []);
            return (
                <div className="stars-container">
                    {stars.map(s => (
                        <div key={s.id} className="star" style={{ top: s.top, left: s.left, width: s.size, height: s.size, '--duration': s.duration, animationDelay: s.delay }} />
                    ))}
                </div>
            );
        };

        const TarotCard = ({ card, theme }) => {
            const isChi = theme.startsWith('chiikawa');
            return (
                <div className="flex flex-col items-center gap-3 animate-fade-up">
                    <div className={`relative w-40 h-64 md:w-48 md:h-72 rounded-2xl p-1 glass ${card.isReversed ? 'rotate-180' : ''}`}>
                        <div className={`w-full h-full rounded-xl overflow-hidden flex flex-col bg-slate-900 shadow-2xl`}>
                            {isChi ? (
                                <img src={CHIIKAWA_IMAGES[card.id]} className="w-full h-full object-cover opacity-90" alt={card.title} />
                            ) : (
                                <div className="flex-1 flex flex-col items-center justify-center space-y-4 text-white">
                                    <div className="text-xs opacity-40 font-serif">{card.numeral}</div>
                                    <Icon name="Sparkles" size={40} className="text-amber-300 opacity-60" />
                                    <div className="font-bold tracking-widest">{card.title}</div>
                                </div>
                            )}
                            <div className="absolute bottom-0 w-full py-2 bg-black/60 backdrop-blur-md text-center">
                                <span className="text-[10px] text-white/50 tracking-[0.3em] font-bold">ARCANA</span>
                            </div>
                        </div>
                    </div>
                    <span className="text-[10px] uppercase font-bold tracking-widest opacity-60">
                        {card.isReversed ? 'é€†ä½' : 'æ­£ä½'}
                    </span>
                </div>
            );
        };

        // --- ä¸»ç¨‹å¼ ---
        const App = () => {
            const [activeTab, setActiveTab] = useState('divination');
            const [theme, setTheme] = useState('night');
            const [gameState, setGameState] = useState('idle');
            const [spreadType, setSpreadType] = useState('one');
            const [userQuestion, setUserQuestion] = useState('');
            const [selectedCards, setSelectedCards] = useState([]);
            const [aiResponse, setAiResponse] = useState('');
            const [isLoadingAi, setIsLoadingAi] = useState(false);
            const [history, setHistory] = useState(JSON.parse(localStorage.getItem('tarot_history') || '[]'));
            const [secretCount, setSecretCount] = useState(0);
            
            // ç³»çµ±æ¶ˆæ¯é€šçŸ¥ç›’
            const [systemMsg, setSystemMsg] = useState(null); 

            // è¨­å®šç®¡ç†å“¡åƒæ•¸
            const [masterApiKey, setMasterApiKey] = useState(localStorage.getItem('arcanum_master_key') || '');
            const [masterPass, setMasterPass] = useState(localStorage.getItem('arcanum_master_pass') || '');
            const [isUnlocked, setIsUnlocked] = useState(false);
            const [unlockInput, setUnlockInput] = useState('');
            const [isSettingOpen, setIsSettingOpen] = useState(false);

            const isChiTheme = theme.startsWith('chiikawa');

            const themeStyles = useMemo(() => {
                const map = {
                    night: { bg: 'bg-[#020617]', text: 'text-slate-100', accent: '#818cf8', panel: 'bg-slate-900/60', btn: 'bg-indigo-600 text-white', input: 'bg-white/5' },
                    day: { bg: 'bg-[#fffbeb]', text: 'text-slate-800', accent: '#ea580c', panel: 'bg-white/60', btn: 'bg-slate-900 text-white', input: 'bg-black/5' },
                    'chiikawa-pink': { bg: 'bg-[#FADDE9]', text: 'text-[#D64E8B]', accent: '#D64E8B', panel: 'bg-white/70', btn: 'bg-[#D64E8B] text-white', input: 'bg-white/50' },
                    'chiikawa-blue': { bg: 'bg-[#D1DCEE]', text: 'text-[#3D5A80]', accent: '#3D5A80', panel: 'bg-white/70', btn: 'bg-[#3D5A80] text-white', input: 'bg-white/50' },
                    'chiikawa-yellow': { bg: 'bg-[#FEF5BC]', text: 'text-[#96831A]', accent: '#96831A', panel: 'bg-white/70', btn: 'bg-[#96831A] text-white', input: 'bg-white/50' }
                };
                return map[theme] || map.night;
            }, [theme]);

            const showMsg = (text, type = 'info') => setSystemMsg({ text, type });

            const encodeKey = (k, p) => btoa(encodeURIComponent(k + "|" + p));
            const decodeKey = (e) => {
                try { return decodeURIComponent(atob(e)).split('|'); } catch { return null; }
            }

            useEffect(() => {
                const params = new URLSearchParams(window.location.search);
                const auth = params.get('auth');
                if (auth) {
                    const res = decodeKey(auth);
                    if (res) {
                        localStorage.setItem('arcanum_master_key', res[0]);
                        localStorage.setItem('arcanum_master_pass', res[1]);
                        setMasterApiKey(res[0]); 
                        setMasterPass(res[1]);
                        window.history.replaceState({}, '', window.location.pathname);
                        showMsg("æˆæ¬Šé‡‘é‘°åŒæ­¥æˆåŠŸï¼å®‡å®™é€£çµå·²å°±ç·’ã€‚", "success");
                    }
                }
            }, []);

            const toggleTheme = () => {
                if (isChiTheme) {
                    const cycle = ['chiikawa-pink', 'chiikawa-blue', 'chiikawa-yellow'];
                    const nextIdx = (cycle.indexOf(theme) + 1) % cycle.length;
                    setTheme(cycle[nextIdx]);
                } else {
                    setTheme(theme === 'night' ? 'day' : 'night');
                }
            };

            const startDivination = () => {
                if (!userQuestion.trim()) {
                    showMsg("è«‹å…ˆå‘Šè¨´å®‡å®™æ‚¨çš„ç–‘æƒ‘ï¼Œæ„Ÿæ‡‰æ‰èƒ½èšç„¦ã€‚", "error");
                    return;
                }
                setGameState('shuffling');
                setIsUnlocked(false);
                setAiResponse('');
                
                setTimeout(() => {
                    const count = spreadType === 'one' ? 1 : 3;
                    const result = [...TAROT_DATA]
                        .sort(() => Math.random() - 0.5)
                        .slice(0, count)
                        .map(c => ({ ...c, isReversed: Math.random() > 0.4 }));
                    
                    setSelectedCards(result);
                    setGameState('revealed');
                    
                    const newEntry = {
                        id: Date.now(),
                        question: userQuestion,
                        cards: result.map(c => ({ id: c.id, title: c.title, isReversed: c.isReversed })),
                        timestamp: new Date().toLocaleString()
                    };
                    const updatedHistory = [newEntry, ...history].slice(0, 5);
                    setHistory(updatedHistory);
                    localStorage.setItem('tarot_history', JSON.stringify(updatedHistory));
                }, 2000);
            };

            const fetchAiInterpretation = async () => {
                const key = masterApiKey || localStorage.getItem('arcanum_master_key');
                const pass = masterPass || localStorage.getItem('arcanum_master_pass');

                if (!key || key.trim() === '') {
                    showMsg("æœªåµæ¸¬åˆ°é‡‘é‘°ã€‚è«‹è‡³ã€Œç™¾ç§‘ > ç®¡ç†å“¡è¨­å®šã€ä¸­å„²å­˜ Gemini API Keyã€‚", "error");
                    return;
                }
                if (!unlockInput) {
                    showMsg("è«‹è¼¸å…¥è§£é–å¯†ç¢¼ä»¥é–‹å•Ÿéˆæ€§è¨Šæ¯ã€‚", "error");
                    return;
                }
                if (unlockInput !== pass) {
                    showMsg("å¯†ç¢¼ä¸æ­£ç¢ºã€‚è«‹å‘ç®¡ç†å“¡è©¢å•æ­£ç¢ºçš„é€²å…¥å¯†èªã€‚", "error");
                    return;
                }
                
                setIsUnlocked(true);
                setIsLoadingAi(true);
                
                const cardDesc = selectedCards.map(c => `${c.title}(${c.isReversed?'é€†ä½':'æ­£ä½'})`).join('ã€');
                const prompt = `ä½ æ˜¯ä¸€ä½è³‡æ·±çš„éˆæ€§å¡”ç¾…å¤§å¸«ã€‚ä½¿ç”¨è€…å•ï¼š${userQuestion}ã€‚æŠ½å‡ºçš„ç‰Œï¼š${cardDesc}ã€‚è«‹æä¾›ä¸€æ®µæº«æŸ”ã€å……æ»¿å•Ÿç™¼æ€§çš„è§£æï¼Œç´„ 300 å­—ã€‚ç›´æ¥æä¾›å…§å®¹ï¼Œåš´ç¦ Markdown ç¬¦è™Ÿã€‚`;

                try {
                    const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${key}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                    });
                    const data = await res.json();
                    
                    if (data.error) {
                        if (data.error.message.includes('blocked')) {
                            throw new Error("é‡‘é‘°å­˜å–è¢« Google å°é–ã€‚è«‹åœ¨ Google Cloud è¨­å®šä¸­å°‡é‡‘é‘°å­˜å–é™åˆ¶ï¼ˆRefererï¼‰è¨­å®šç‚ºã€Œç„¡é™åˆ¶ã€ã€‚");
                        }
                        throw new Error(data.error.message);
                    }
                    
                    setAiResponse(data.candidates?.[0]?.content?.parts?.[0]?.text || "å•Ÿç¤ºç›®å‰é¡¯å¾—æ¨¡ç³Šï¼Œè«‹å†è©¦ä¸€æ¬¡ã€‚");
                } catch (e) {
                    showMsg("é€£ç·šå¤±æ•—ï¼š" + e.message, "error");
                    setIsUnlocked(false);
                } finally {
                    setIsLoadingAi(false);
                }
            };

            const saveSettings = () => {
                if(!masterApiKey) {
                    showMsg("è«‹å…ˆè¼¸å…¥ API Key å†å„²å­˜ã€‚", "error");
                    return;
                }
                localStorage.setItem('arcanum_master_key', masterApiKey);
                localStorage.setItem('arcanum_master_pass', masterPass);
                showMsg("è¨­å®šå·²å„²å­˜è‡³ç€è¦½å™¨å¿«å–ã€‚æ‚¨å¯ä»¥é–‹å§‹å•Ÿå‹•å®‡å®™æ„Ÿæ‡‰äº†ï¼", "success");
            };

            const shareAuth = () => {
                if (!masterApiKey || !masterPass) {
                    showMsg("è«‹å…ˆå„²å­˜é‡‘é‘°èˆ‡å¯†ç¢¼å¾Œæ‰èƒ½ç”Ÿæˆé€£çµã€‚", "error");
                    return;
                }
                const link = `${window.location.origin}${window.location.pathname}?auth=${encodeKey(masterApiKey, masterPass)}`;
                const textArea = document.createElement("textarea");
                textArea.value = link;
                textArea.style.position = "fixed"; textArea.style.left = "-9999px";
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    showMsg("å°ˆå±¬æˆæ¬Šé€£çµå·²è¤‡è£½ï¼è¦ªå‹åªéœ€é»é–‹ç¶²å€å³å¯è‡ªå‹•é…å°ã€‚", "success");
                } catch (err) {
                    showMsg("è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½ç¶²å€åˆ†äº«ã€‚", "error");
                }
                document.body.removeChild(textArea);
            };

            return (
                <div className={`min-h-screen ${themeStyles.bg} ${themeStyles.text} transition-all duration-1000 pb-24 relative overflow-hidden`}>
                    <StarField />
                    
                    {/* éˆæ€§è¨Šæ¯ç›’ */}
                    {systemMsg && (
                        <div className="fixed inset-0 z-[100] flex items-center justify-center p-6 modal-overlay no-select">
                            <div className="w-full max-w-sm glass rounded-[3rem] p-10 text-center space-y-6 animate-fade-up border-2 border-white/20">
                                <div className={`w-14 h-14 rounded-full mx-auto flex items-center justify-center ${systemMsg.type === 'error' ? 'bg-rose-500/20 text-rose-500' : 'bg-emerald-500/20 text-emerald-500'}`}>
                                    <Icon name={systemMsg.type === 'error' ? 'X' : 'Sparkles'} size={28} />
                                </div>
                                <div className="space-y-2">
                                    <h4 className="font-bold text-lg">{systemMsg.type === 'error' ? 'é€£ç·šä¸ç©©å®š' : 'å®‡å®™æŒ‡å¼•'}</h4>
                                    <p className="text-sm opacity-80 leading-relaxed break-words">{systemMsg.text}</p>
                                </div>
                                <button onClick={() => setSystemMsg(null)} className={`w-full py-4 rounded-2xl font-bold text-xs uppercase tracking-widest ${themeStyles.btn} btn-active shadow-lg transition-all`}>
                                    äº†è§£ä¸¦é—œé–‰
                                </button>
                            </div>
                        </div>
                    )}

                    {/* Header */}
                    <header className="max-w-4xl mx-auto px-6 py-8 flex justify-between items-center relative z-20">
                        <div className="flex items-center gap-3 cursor-pointer no-select"
                            onClick={() => {
                                const next = secretCount + 1;
                                setSecretCount(next);
                                if (next >= 5) { setTheme('chiikawa-pink'); setSecretCount(0); }
                            }}>
                            <div className="p-2.5 rounded-2xl glass bg-white/10">
                                <Icon name={isChiTheme ? "ChiikawaHead" : "Sparkles"} size={26} className={isChiTheme ? "text-white" : "text-amber-300"} />
                            </div>
                            <h1 className="text-xl md:text-2xl font-serif font-bold tracking-widest transition-all">
                                {isChiTheme ? "å¤§é˜¿çˆ¾å…‹ç´ & Chiikawa" : "å¤§é˜¿çˆ¾å…‹ç´"}
                            </h1>
                        </div>
                        <div className="flex gap-2 items-center">
                            {isChiTheme ? (
                                <>
                                    <button onClick={toggleTheme} className="w-12 h-12 rounded-full glass bg-white/5 flex items-center justify-center btn-active">
                                        {theme === 'chiikawa-pink' ? <Icon name="ChiikawaHead" size={28} /> :
                                         theme === 'chiikawa-blue' ? <Icon name="HachiwareHead" size={28} /> :
                                         <Icon name="UsagiHead" size={28} />}
                                    </button>
                                    <button onClick={() => setTheme('night')} className="px-5 h-12 rounded-full btn-return-classic flex items-center gap-2 btn-active transition-all">
                                        <Icon name="LogOut" size={16} />
                                        <span className="font-bold text-sm tracking-widest">è¿”å›ç¶“å…¸</span>
                                    </button>
                                </>
                            ) : (
                                <button onClick={toggleTheme} className="w-12 h-12 rounded-full glass bg-white/5 flex items-center justify-center btn-active">
                                    <Icon name={theme === 'night' ? "Moon" : "Sun"} size={18} />
                                </button>
                            )}
                        </div>
                    </header>

                    <main className="max-w-4xl mx-auto px-6 relative z-10">
                        {activeTab === 'divination' && (
                            <div className="space-y-12">
                                {gameState === 'idle' && (
                                    <div className="animate-fade-up flex flex-col items-center text-center space-y-10 py-12">
                                        <div className="space-y-4">
                                            <h2 className="text-3xl md:text-4xl font-serif font-bold italic transition-all leading-tight">ã€Œé–‰ä¸Šé›™çœ¼ï¼Œæ·±å‘¼å¸ï¼Œ<br/>è®“æ‚¨çš„å›°æƒ‘åœ¨æ­¤æµ®ç¾ã€‚ã€</h2>
                                            <p className="text-sm opacity-50 tracking-[0.2em] font-light">é€™æ˜¯ä¸€å€‹éˆé­‚èˆ‡å®‡å®™å°è©±çš„æ™‚åˆ»</p>
                                        </div>
                                        
                                        <textarea 
                                            value={userQuestion}
                                            onChange={e => setUserQuestion(e.target.value)}
                                            placeholder="åœ¨æ­¤è¼¸å…¥æ‚¨æƒ³å•çš„äº‹æƒ…..."
                                            className={`w-full max-w-2xl h-40 glass ${themeStyles.panel} rounded-[2rem] p-8 focus:outline-none focus:ring-2 ring-white/20 transition-all text-lg placeholder:opacity-20 resize-none shadow-inner`}
                                        />

                                        <div className="flex gap-4 w-full max-w-md no-select">
                                            <button onClick={() => setSpreadType('one')} className={`flex-1 py-4 rounded-2xl glass transition-all border-2 ${spreadType === 'one' ? 'border-amber-400/60 bg-amber-400/10 scale-105' : 'border-transparent opacity-40'}`}>
                                                ä¸€ç‰Œç›´è¦º
                                            </button>
                                            <button onClick={() => setSpreadType('three')} className={`flex-1 py-4 rounded-2xl glass transition-all border-2 ${spreadType === 'three' ? 'border-amber-400/60 bg-amber-400/10 scale-105' : 'border-transparent opacity-40'}`}>
                                                è–ä¸‰è§’
                                            </button>
                                        </div>

                                        <button onClick={startDivination} className={`px-12 py-5 ${themeStyles.btn} rounded-full font-bold tracking-[0.5em] shadow-2xl hover:scale-105 btn-active transition-all uppercase`}>
                                            å•Ÿå‹•éˆæ€§æ„Ÿæ‡‰
                                        </button>
                                    </div>
                                )}

                                {gameState === 'shuffling' && (
                                    <div className="flex flex-col items-center justify-center py-32 space-y-12 no-select transition-all">
                                        <div className="relative w-40 h-60">
                                            {[...Array(5)].map((_, i) => (
                                                <div key={i} className={`absolute inset-0 glass bg-slate-800 rounded-2xl card-shuffle border-2 border-white/10`} style={{ animationDelay: `${i*0.1}s`, zIndex: 5-i }} />
                                            ))}
                                        </div>
                                        <div className="text-center space-y-4">
                                            <p className="text-xl font-serif italic animate-pulse opacity-60 tracking-[0.3em]">æ­£åœ¨æœå°‹å‘½é‹è»Œè·¡...</p>
                                            <p className="text-[10px] opacity-20 uppercase font-bold tracking-[0.4em]">Syncing with Celestial Energy</p>
                                        </div>
                                    </div>
                                )}

                                {gameState === 'revealed' && (
                                    <div className="space-y-16 animate-fade-up pb-12">
                                        <div className="flex flex-wrap justify-center gap-6 md:gap-12">
                                            {selectedCards.map((c, i) => (
                                                <TarotCard key={i} card={c} theme={theme} />
                                            ))}
                                        </div>

                                        <div className="glass rounded-[3rem] p-8 md:p-14 space-y-8 shadow-2xl border-white/20">
                                            <div className="flex items-center gap-2 opacity-50 text-xs font-bold tracking-widest uppercase italic border-b border-white/10 pb-4">
                                                <Icon name="Sparkles" size={14} /> å®‡å®™çš„æ·±åº¦å•Ÿç¤º
                                            </div>

                                            {!isUnlocked ? (
                                                <div className="flex flex-col items-center py-10 space-y-8">
                                                    <div className="p-6 rounded-full bg-white/5 animate-pulse">
                                                        <Icon name="Lock" size={48} className="opacity-20" />
                                                    </div>
                                                    <div className="flex flex-col items-center gap-4 w-full max-w-xs">
                                                        <input 
                                                            type="text" value={unlockInput} onChange={e => setUnlockInput(e.target.value)} placeholder="è¼¸å…¥è¨ªå•å¯†ç¢¼"
                                                            className={`w-full ${themeStyles.input} border border-white/10 rounded-2xl px-4 py-5 text-center focus:outline-none transition-all text-lg shadow-inner`}
                                                        />
                                                        <button 
                                                            onClick={fetchAiInterpretation}
                                                            disabled={isLoadingAi}
                                                            className={`w-full py-5 ${themeStyles.btn} rounded-2xl font-bold text-sm uppercase tracking-widest btn-active disabled:opacity-50 transition-all shadow-xl`}
                                                        >
                                                            æ„Ÿæ‡‰å®‡å®™è¨Šæ¯
                                                        </button>
                                                    </div>
                                                </div>
                                            ) : (
                                                <div className="min-h-[200px]">
                                                    {isLoadingAi ? (
                                                        <div className="flex flex-col items-center justify-center py-20 gap-4 opacity-40">
                                                            <Icon name="Refresh" size={32} className="animate-spin" />
                                                            <p className="text-xs animate-pulse font-serif tracking-widest uppercase">èƒ½é‡åŒæ­¥ä¸­...</p>
                                                        </div>
                                                    ) : (
                                                        <div className="leading-relaxed text-lg md:text-xl whitespace-pre-wrap font-light italic text-justify opacity-90 animate-fade-up transition-all">
                                                            {aiResponse}
                                                        </div>
                                                    )}
                                                </div>
                                            )}
                                        </div>

                                        <div className="grid grid-cols-1 gap-6">
                                            {selectedCards.map((c, i) => (
                                                <div key={i} className="glass rounded-[2.5rem] p-8 space-y-6">
                                                    <h3 className="text-2xl font-bold font-serif">{c.title} <span className="text-sm opacity-30 tracking-widest uppercase">({c.isReversed?'é€†ä½':'æ­£ä½'})</span></h3>
                                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                        {['love', 'work', 'finance', 'social'].map(key => (
                                                            <div key={key} className="p-5 bg-white/5 rounded-[1.5rem] space-y-2 border border-white/5">
                                                                <div className="text-[10px] font-bold opacity-30 uppercase tracking-widest">{key === 'love' ? 'ğŸ’– æ„Ÿæƒ…' : key === 'work' ? 'ğŸ’¼ äº‹æ¥­' : key === 'finance' ? 'ğŸ’° è²¡é‹' : 'ğŸ¤ ç¤¾äº¤'}</div>
                                                                <p className="text-sm leading-relaxed opacity-75">{c[key][c.isReversed ? 1 : 0]}</p>
                                                            </div>
                                                        ))}
                                                    </div>
                                                </div>
                                            ))}
                                        </div>

                                        <button onClick={() => setGameState('idle')} className="w-full py-5 border-2 border-white/10 rounded-full opacity-40 hover:opacity-100 hover:bg-white/5 transition-all text-sm font-bold uppercase tracking-[0.3em] btn-active">
                                            é‡æ–°å•Ÿå‹•å åœ
                                        </button>
                                    </div>
                                )}
                            </div>
                        )}

                        {activeTab === 'history' && (
                            <div className="animate-fade-up space-y-8 py-10 pb-20">
                                <h2 className="text-3xl font-serif font-bold tracking-widest">æ­·å²æ„Ÿæ‡‰ç´€éŒ„</h2>
                                {history.length === 0 ? (
                                    <div className="py-32 text-center opacity-20 italic">å°šæœªè¨˜éŒ„ä»»ä½•éˆé­‚è¶³è·¡</div>
                                ) : (
                                    <div className="space-y-4">
                                        {history.map(h => (
                                            <div key={h.id} className="glass rounded-[2rem] p-8 flex flex-col md:flex-row justify-between items-start md:items-center gap-6 border border-white/5">
                                                <div className="space-y-2">
                                                    <div className="text-[10px] opacity-30 font-mono tracking-widest uppercase">{h.timestamp}</div>
                                                    <div className="font-bold text-lg opacity-90">å•ï¼š{h.question}</div>
                                                </div>
                                                <div className="flex gap-2 flex-wrap">
                                                    {h.cards.map((c, i) => (
                                                        <div key={i} className="px-4 py-2 bg-white/10 rounded-xl text-xs font-bold border border-white/5 shadow-sm">
                                                            {c.title} {c.isReversed ? 'â†“' : 'â†‘'}
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        )}

                        {activeTab === 'guide' && (
                            <div className="animate-fade-up space-y-10 py-10 pb-20">
                                <section className="space-y-6">
                                    <h3 className="text-2xl font-serif font-bold border-l-4 border-amber-400 pl-4 tracking-widest">é˜¿çˆ¾å…‹ç´ç™¾ç§‘</h3>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        {TAROT_DATA.map(c => (
                                            <div key={c.id} className="glass rounded-[1.5rem] p-6 flex items-center gap-6 border border-white/5 hover:bg-white/5 transition-all">
                                                <div className="w-14 h-14 rounded-full glass flex items-center justify-center font-serif opacity-30 text-sm border-2 border-white/10">
                                                    {c.numeral}
                                                </div>
                                                <div className="flex flex-col">
                                                    <span className="font-bold text-lg tracking-widest">{c.title}</span>
                                                    <span className="text-xs opacity-40">{c.meaning}</span>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </section>
                                
                                <section className="pt-10 border-t border-white/5 space-y-6">
                                    <button onClick={() => setIsSettingOpen(!isSettingOpen)} className="w-full py-4 glass rounded-[1.5rem] text-[11px] font-bold opacity-30 hover:opacity-100 flex items-center justify-center gap-2 transition-all uppercase tracking-[0.2em]">
                                        ç®¡ç†å“¡é€²éšè¨­å®š <Icon name="Chevron" size={12} className={isSettingOpen ? 'rotate-180' : ''} />
                                    </button>
                                    
                                    {isSettingOpen && (
                                        <div className="p-8 glass rounded-[2.5rem] space-y-10 animate-fade-up border-white/20">
                                            <div className="space-y-6 text-center">
                                                <div className="space-y-2">
                                                    <p className="text-sm font-bold tracking-widest uppercase">ç³»çµ±æ ¸å¿ƒè¨­å®š</p>
                                                    <p className="text-[11px] opacity-40 leading-relaxed italic">è¨­å®šæ‚¨çš„ Gemini API é‡‘é‘°èˆ‡è¨ªå•å¯†ç¢¼ã€‚é‡‘é‘°è«‹è‡³ Google AI Studio ç”³è«‹ä¸”éœ€è¨­ç‚ºã€Œç„¡é™åˆ¶ã€å­˜å–ã€‚</p>
                                                </div>
                                                <div className="space-y-3">
                                                    <input 
                                                        type="password" placeholder="Gemini API Key (è²¼ä¸Šé‡‘é‘°)" value={masterApiKey} onChange={e => setMasterApiKey(e.target.value)}
                                                        className={`w-full ${themeStyles.input} border border-white/10 rounded-2xl px-4 py-5 text-center focus:outline-none transition-all text-sm`}
                                                    />
                                                    <input 
                                                        type="text" placeholder="è¨­å®šè§£é–å¯†ç¢¼ (ç”¨æ–¼å åœè§£é–)" value={masterPass} onChange={e => setMasterPass(e.target.value)}
                                                        className={`w-full ${themeStyles.input} border border-white/10 rounded-2xl px-4 py-5 text-center focus:outline-none transition-all text-sm`}
                                                    />
                                                </div>
                                                <div className="flex gap-3 pt-2">
                                                    <button onClick={saveSettings} className={`flex-1 py-5 bg-indigo-600 hover:bg-indigo-500 text-white rounded-2xl font-bold uppercase tracking-widest flex items-center justify-center gap-2 btn-active transition-all shadow-xl`}>
                                                        <Icon name="Save" size={16} /> å„²å­˜è¨­å®š
                                                    </button>
                                                    <button onClick={shareAuth} className={`flex-1 py-5 glass bg-white/10 hover:bg-white/20 text-white rounded-2xl font-bold uppercase tracking-widest flex items-center justify-center gap-2 btn-active transition-all shadow-xl`}>
                                                        <Icon name="Share" size={16} /> åˆ†äº«é€£çµ
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    )}
                                </section>
                            </div>
                        )}
                    </main>

                    {/* Nav */}
                    <nav className="fixed bottom-0 left-0 w-full glass border-t border-white/10 py-6 px-10 flex justify-around items-center z-50 transition-all">
                        {[
                            { id: 'divination', label: 'å åœ', icon: 'Sparkles' },
                            { id: 'history', label: 'ç´€éŒ„', icon: 'History' },
                            { id: 'guide', label: 'ç™¾ç§‘', icon: 'Book' }
                        ].map(tab => (
                            <button 
                                key={tab.id} onClick={() => setActiveTab(tab.id)}
                                className={`flex flex-col items-center gap-1.5 transition-all ${activeTab === tab.id ? 'opacity-100 scale-110' : 'opacity-25'}`}
                                style={{ color: activeTab === tab.id ? themeStyles.accent : 'currentColor' }}
                            >
                                <Icon name={tab.icon} size={26} />
                                <span className="text-[11px] font-bold tracking-widest uppercase">{tab.label}</span>
                            </button>
                        ))}
                    </nav>
                </div>
            );
        };

        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);
    </script>
</body>
</html>
