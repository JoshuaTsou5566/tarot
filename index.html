<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>大阿爾克那占卜</title>
    <!-- 載入 React 核心 -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- 載入 Babel 編譯器 -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- 載入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 載入 Lucide 原生圖示庫 (最穩定) -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700&family=Noto+Sans+TC:wght@300;400;500;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; transition: background-color 1s ease; margin: 0; padding: 0; }
        .font-serif { font-family: 'Noto Serif TC', serif; }
        .transition-colors { transition-duration: 1000ms; }
        ::-webkit-scrollbar { display: none; }
        .animate-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        /* 避免手機長按彈出選單影響截圖 */
        .no-select { -webkit-touch-callout: none; -webkit-user-select: none; user-select: none; }
    </style>
</head>
<body class="bg-[#020617]">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- 靜態資料定義 ---
        const apiKey = "AIzaSyDNwWYgLV6fMliw_Q-YAokjx3iONrgp5jE"; 

        const CHIIKAWA_IMAGES = {
            0: "https://raw.githubusercontent.com/JoshuaTsou5566/tarot/heads/main/0.jpg",
            1: "https://raw.githubusercontent.com/JoshuaTsou5566/tarot/heads/main/1.jpg",
            2: "https://raw.githubusercontent.com/JoshuaTsou5566/tarot/heads/main/2.jpg",
            3: "https://raw.githubusercontent.com/JoshuaTsou5566/tarot/heads/main/3.jpg",
            4: "https://raw.githubusercontent.com/JoshuaTsou5566/tarot/heads/main/4.jpg",
            5: "https://raw.githubusercontent.com/JoshuaTsou5566/tarot/heads/main/5.jpg",
            6: "https://raw.githubusercontent.com/JoshuaTsou5566/tarot/heads/main/6.jpg",
            7: "https://raw.githubusercontent.com/JoshuaTsou5566/tarot/heads/main/7.jpg",
            8: "https://raw.githubusercontent.com/JoshuaTsou5566/tarot/heads/main/8.jpg",
            9: "https://raw.githubusercontent.com/JoshuaTsou5566/tarot/heads/main/9.jpg",
            10: "https://raw.githubusercontent.com/JoshuaTsou5566/tarot/heads/main/10.jpg",
            11: "https://raw.githubusercontent.com/JoshuaTsou5566/tarot/heads/main/11.jpg",
            12: "https://raw.githubusercontent.com/JoshuaTsou5566/tarot/heads/main/12.jpg",
            13: "https://raw.githubusercontent.com/JoshuaTsou5566/tarot/heads/main/13.jpg",
            14: "https://raw.githubusercontent.com/JoshuaTsou5566/tarot/heads/main/14.jpg",
            15: "https://raw.githubusercontent.com/JoshuaTsou5566/tarot/heads/main/15.jpg",
            16: "https://raw.githubusercontent.com/JoshuaTsou5566/tarot/heads/main/16.jpg",
            17: "https://raw.githubusercontent.com/JoshuaTsou5566/tarot/heads/main/17.jpg",
            18: "https://raw.githubusercontent.com/JoshuaTsou5566/tarot/heads/main/18.jpg",
            19: "https://raw.githubusercontent.com/JoshuaTsou5566/tarot/heads/main/19.jpg",
            20: "https://raw.githubusercontent.com/JoshuaTsou5566/tarot/heads/main/20.jpg",
            21: "https://raw.githubusercontent.com/JoshuaTsou5566/tarot/heads/main/21.jpg"
        };

        const TAROT_DATA = [
            { id: 0, numeral: "0", title: "愚者", french: "Le Fou", meaning: "狡猾之者", astrology: "天王星", essence: "最初的虛無", uprightInsight: "代表一個全新的開始，充滿無限可能。不要害怕未知，保持赤子之心去冒險。", reversedInsight: "暗示過於魯莽或不負責任。在跳入深淵之前，請先確認腳下的土地是否穩固。" },
            { id: 1, numeral: "I", title: "魔術師", french: "Le Bateleur", meaning: "出發、發現、創造", astrology: "水星", essence: "萬物的開端", uprightInsight: "你已經擁有了達成目標所需的所有工具。現在是將想法轉化為現實的時刻。", reversedInsight: "潛力可能被浪費，或者你的能力未被正確引導。小心身邊的欺瞞。" },
            { id: 2, numeral: "II", title: "女祭司", french: "La Papesse", meaning: "女性的神秘", astrology: "月球", essence: "陰陽", uprightInsight: "傾聽你的直覺與夢境。有些真相不需要外求，而是需要安靜地等待其浮現。", reversedInsight: "忽視了內心的聲音。可能過於壓抑情感，需重新找回寧靜。" },
            { id: 3, numeral: "III", title: "皇后", french: "L'Impératrice", meaning: "包容、豐收、豐腴", astrology: "金星", essence: "愛、生命、和平", uprightInsight: "大地的豐饒與創造力正在流動。這是一個孕育計畫、藝術創作的好時機。", reversedInsight: "過度的保護欲可能導致窒息。需要重新尋求內在與外在的平衡。" },
            { id: 4, numeral: "IV", title: "皇帝", french: "L'Emperuer", meaning: "自我的權利", astrology: "白羊座", essence: "四大元素", uprightInsight: "展現領導力與紀律。結構與秩序將為你帶來成功，這是穩定局勢的時候。", reversedInsight: "暗示暴政或控制欲過強。過於僵化的規則可能阻礙了成長。" },
            { id: 5, numeral: "V", title: "教皇", french: "Le Pape", meaning: "知識與道德", astrology: "金牛座", essence: "平均的力量", uprightInsight: "遵循傳統或尋求專業的導引。在規範中，你將找到答案。", reversedInsight: "鼓勵打破陳規，挑戰傳統權威。是時候尋找屬於你自己的真理。" },
            { id: 6, numeral: "VI", title: "戀人", french: "L'Amant", meaning: "上天的祝福", astrology: "雙子座", essence: "天地的調和", uprightInsight: "面臨關鍵的選擇與和諧的關係。這是心靈層面的完美契合。", reversedInsight: "關係可能失衡或決策不一。可能面臨內心的矛盾或短暫的誘惑。" },
            { id: 7, numeral: "VII", title: "戰車", french: "Le Chariot", meaning: "熱情", astrology: "巨蟹座", essence: "勝利", uprightInsight: "憑藉意志力克服障礙。專注目標，驅動你的成功之路。", reversedInsight: "方向迷失或情緒失控。過度的野心可能導致衝突。" },
            { id: 8, numeral: "VIII", title: "力量", french: "La Force", meaning: "支配", astrology: "獅子座", essence: "力量的穩定", uprightInsight: "以柔克剛，展現內在的勇氣。真正的力量來自於慈悲與韌性。", reversedInsight: "可能感到自卑或被原始慾望支配。失去了對局勢的掌控。" },
            { id: 9, numeral: "IX", title: "隱者", french: "L'Ermite", meaning: "知識", astrology: "處女座", essence: "調和大三角", uprightInsight: "向內探索，尋求孤獨與反思。你將在寂靜中看見真理之光。", reversedInsight: "過度與世隔絕或逃避現實。小心固執帶來的盲點。" },
            { id: 10, numeral: "X", title: "命運之輪", french: "La Roue de la fortune", meaning: "天使與魔鬼", astrology: "木星", essence: "宇宙的基礎", uprightInsight: "轉機即將來臨。接受命運的波動，宇宙的力量正推向新階段。", reversedInsight: "運氣停滯或不順。不要試圖抵抗改變，學會適應低潮。" },
            { id: 11, numeral: "XI", title: "正義", french: "La Justice", meaning: "公平的真理", astrology: "天秤座", essence: "不完整", uprightInsight: "誠實面對現況。因果報應正在運作，公平將得到彰顯。", reversedInsight: "面臨不公平的待遇或推卸責任。法律或決定可能對你不利。" },
            { id: 12, numeral: "XII", title: "倒吊人", french: "Le Pendu", meaning: "自我犧牲", astrology: "海王星", essence: "終點", uprightInsight: "換個角度看世界。現在是等待與觀望的時刻，換取更高覺醒。", reversedInsight: "徒勞無功的犧牲。拒絕改變觀點，或為了不值得的事消耗能量。" },
            { id: 13, numeral: "XIII", title: "死神", french: "La Mort", meaning: "循環", astrology: "天蠍座", essence: "死亡人數", uprightInsight: "終結與新生的開始。徹底放下舊有模式，迎接純淨的啟程。", reversedInsight: "恐懼改變而死守現狀。抗拒結束只會延長痛苦。" },
            { id: 14, numeral: "XIV", title: "節制", french: "Tempérance", meaning: "自我控制", astrology: "射手座", essence: "適當", uprightInsight: "融合與平衡。保持耐心與平和，事物將以最和諧的方式成形。", reversedInsight: "生活失衡或資源浪費。情緒的極端導致原本和諧的局面變混亂。" },
            { id: 15, numeral: "XV", title: "惡魔", french: "Le Diable", meaning: "慾望", astrology: "魔羯座", essence: "野性", uprightInsight: "面對影子的時刻。你可能被慾望束縛，覺察是重獲自由的第一步。", reversedInsight: "從束縛中覺醒。你開始意識到陰暗面，並獲得力量打破限制。" },
            { id: 16, numeral: "XVI", title: "塔", french: "La Maison Dieu", meaning: "驕傲者必亡", astrology: "火星", essence: "惡意的基盤", uprightInsight: "劇烈且突如其來的崩解。摧毀虛偽基礎，強迫你重新開始。", reversedInsight: "避開了重大災難。雖然混亂正在醞釀，但仍有機會調整。" },
            { id: 17, numeral: "XVII", title: "星星", french: "L'Étoile", meaning: "魂魄飛向宇宙", astrology: "水瓶座", essence: "治癒", uprightInsight: "希望與平靜。星光照亮了前路，這是一個心靈療癒的時期。", reversedInsight: "感到失望或靈感枯竭。暫時迷失方向，需重新點燃希望。" },
            { id: 18, numeral: "XVIII", title: "月亮", french: "La Lune", meaning: "黑暗的降臨", astrology: "雙魚座", essence: "不安、淨化", uprightInsight: "潛意識的波瀾。需警惕隱藏的敵意以及內心深處的不安情緒。", reversedInsight: "迷霧開始散去。真相逐漸浮現，你已學會從混亂中辨識真實。" },
            { id: 19, numeral: "XIX", title: "太陽", french: "Le Soleil", meaning: "崇拜", astrology: "太陽", essence: "新生命誕生", uprightInsight: "純粹的喜悅與成功。生命充滿陽光，所有的努力都將圓滿。", reversedInsight: "暫時的陰影。雖然成功依舊，但需小心自我膨脹或過度樂觀。" },
            { id: 20, numeral: "XX", title: "審判", french: "Le Juge", meaning: "復活", astrology: "冥王星", essence: "極限", uprightInsight: "靈魂的覺醒與感召。這是一個重生與邁向更高層次的時刻。", reversedInsight: "拒絕面對過去。靈魂的呼喚被忽視，因恐懼責任而裹足不前。" },
            { id: 21, numeral: "XXI", title: "世界", french: "Le Monde", meaning: "完美無缺", astrology: "土星", essence: "最終的虛無", uprightInsight: "完美的圓滿與旅程終點。你已完成功課，迎來全方位達成感。", reversedInsight: "接近成功但仍有未竟之志。或者是你對完成目標感到拖延。" }
        ];

        // --- 組件輔助：圖示封裝 ---
        const Icon = ({ name, size = 24, className = "" }) => {
            const iconRef = useRef(null);
            useEffect(() => {
                if (window.lucide) {
                    window.lucide.createIcons({
                        attrs: {
                            class: `lucide-${name} ${className}`,
                            width: size,
                            height: size
                        },
                        name: name
                    });
                }
            }, [name, size, className]);

            return <i data-lucide={name} className={className} style={{ width: size, height: size, display: 'inline-block' }}></i>;
        };

        const App = () => {
            const [theme, setTheme] = useState('night');
            const [activeTab, setActiveTab] = useState('divination');
            const [gameState, setGameState] = useState('idle');
            const [spreadType, setSpreadType] = useState('one');
            const [userQuestion, setUserQuestion] = useState('');
            const [selectedCards, setSelectedCards] = useState([]);
            const [aiResponse, setAiResponse] = useState('');
            const [isAiLoading, setIsAiLoading] = useState(false);
            const [history, setHistory] = useState([]);
            const [isShareMode, setIsShareMode] = useState(false);
            const [secretClickCount, setSecretClickCount] = useState(0);

            // 當內容更新時重新初始化所有圖示
            useEffect(() => {
                if (window.lucide) window.lucide.createIcons();
            }, [activeTab, gameState, isShareMode, theme]);

            const handleSecretClick = () => {
                const nextCount = secretClickCount + 1;
                if (nextCount >= 5) {
                    setTheme('chiikawa-pink');
                    setSecretClickCount(0);
                } else {
                    setSecretClickCount(nextCount);
                }
            };

            const toggleTheme = () => {
                if (theme === 'chiikawa-pink') setTheme('chiikawa-blue');
                else if (theme === 'chiikawa-blue') setTheme('chiikawa-yellow');
                else if (theme === 'chiikawa-yellow') setTheme('chiikawa-pink');
                else setTheme(prev => prev === 'night' ? 'day' : 'night');
            };

            const returnToClassic = () => setTheme('night');
            const isChiikawa = theme.startsWith('chiikawa');

            const themeStyles = {
                night: {
                    bg: "bg-[#020617]", text: "text-slate-100", secondaryText: "text-slate-400",
                    glow1: "bg-indigo-900", glow2: "bg-purple-900", navBg: "bg-slate-900/80", cardBg: "bg-slate-900",
                    btnBg: "bg-white text-slate-950", panelBg: "bg-slate-900/60", border: "border-white/10",
                    inputBg: "bg-slate-900/40", accent: "text-amber-200", subAccent: "text-indigo-400"
                },
                day: {
                    bg: "bg-[#fffbeb]", text: "text-slate-800", secondaryText: "text-slate-500",
                    glow1: "bg-amber-200", glow2: "bg-orange-200", navBg: "bg-white/80", cardBg: "bg-white",
                    btnBg: "bg-slate-900 text-white", panelBg: "bg-white/80", border: "border-amber-900/10",
                    inputBg: "bg-white/60", accent: "text-orange-700", subAccent: "text-amber-600"
                },
                'chiikawa-pink': {
                    bg: "bg-[#EFA5C9]", text: "text-[#5D2E46]", secondaryText: "text-[#8E4A6E]",
                    glow1: "bg-white/40", glow2: "bg-[#FADDE9]", navBg: "bg-white/70", cardBg: "bg-white",
                    btnBg: "bg-[#D64E8B] text-white", activeBtn: "bg-[#D64E8B] border-[#D64E8B] text-white",
                    panelBg: "bg-[#FFF0F6]/95", border: "border-[#F4C1D9]", inputBg: "bg-white/70", accent: "text-[#D64E8B]"
                },
                'chiikawa-blue': {
                    bg: "bg-[#91A8D0]", text: "text-[#1B2A4E]", secondaryText: "text-[#3D5A80]",
                    glow1: "bg-white/40", glow2: "bg-[#D1DCEE]", navBg: "bg-white/70", cardBg: "bg-white",
                    btnBg: "bg-[#3D5A80] text-white", activeBtn: "bg-[#3D5A80] border-[#3D5A80] text-white",
                    panelBg: "bg-[#E8EEF8]/95", border: "border-[#B8C9E5]", inputBg: "bg-white/70", accent: "text-[#3D5A80]"
                },
                'chiikawa-yellow': {
                    bg: "bg-[#FFF9D4]", text: "text-[#4D432A]", secondaryText: "text-[#7A6F44]",
                    glow1: "bg-white/50", glow2: "bg-[#FEF5BC]", navBg: "bg-white/70", cardBg: "bg-white",
                    btnBg: "bg-[#96831A] text-white", activeBtn: "bg-[#96831A] border-[#96831A] text-white",
                    panelBg: "bg-[#FFFEF2]/95", border: "border-[#E8DE95]", inputBg: "bg-white/70", accent: "text-[#96831A]"
                }
            }[theme];

            const fetchAiInterpretation = async (question, cards, type) => {
                setIsAiLoading(true);
                setAiResponse('');
                const cardInfo = cards.map((c, i) => `${type === 'triangle' ? ['過去','現在','未來'][i] : '核心'}: ${c.title}(${c.isReversed ? '逆' : '正'})`).join('\n');
                const prompt = `你是一位專業塔羅大師。問題：${question || '一般性指引'}。牌組：\n${cardInfo}\n\n簡潔明確、溫暖大方地解讀。好結果鼓勵，壞結果轉化為祝福與提醒。嚴禁 Markdown。`;

                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                    });
                    const data = await response.json();
                    setAiResponse((data.candidates?.[0]?.content?.parts?.[0]?.text || "").replace(/\*\*/g, '').replace(/###/g, ''));
                } catch (e) {
                    setAiResponse("宇宙信號干擾中，請參考下方基本牌義。");
                } finally {
                    setIsAiLoading(false);
                }
            };

            const drawCards = () => {
                setGameState('shuffling');
                setTimeout(() => {
                    const count = spreadType === 'one' ? 1 : 3;
                    const drawn = [...TAROT_DATA].sort(() => Math.random() - 0.5).slice(0, count).map(c => ({
                        ...c, isReversed: Math.random() > 0.35, timestamp: new Date().toLocaleTimeString()
                    }));
                    setSelectedCards(drawn);
                    setGameState('revealed');
                    fetchAiInterpretation(userQuestion, drawn, spreadType);
                    setHistory(prev => [{ cards: drawn, question: userQuestion || '一般指引', time: new Date().toLocaleString() }, ...prev].slice(0, 10));
                }, 2000);
            };

            const resetGame = () => {
                setGameState('idle');
                setSelectedCards([]);
                setAiResponse('');
                setUserQuestion('');
                setIsShareMode(false);
            };

            if (isShareMode) {
                return (
                    <div className={`min-h-screen ${themeStyles.bg} flex flex-col items-center p-6 transition-colors duration-1000`}>
                        <div className={`w-full max-w-md ${themeStyles.panelBg} border ${themeStyles.border} rounded-[2.5rem] p-8 shadow-2xl relative overflow-hidden`}>
                            <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-amber-400 to-purple-500" />
                            <h1 className="text-2xl font-serif font-bold text-center mb-6">{isChiikawa ? '阿爾克納 & Chiikawa' : '大阿爾克那啟示'}</h1>
                            <div className="flex justify-center gap-2 mb-6">
                                {selectedCards.map((c, i) => (
                                    <div key={i} className={`w-24 h-40 bg-slate-900 border ${themeStyles.border} rounded-lg flex flex-col items-center justify-between p-2 ${c.isReversed ? 'rotate-180' : ''}`}>
                                        <div className="text-[10px] opacity-30">{c.numeral}</div>
                                        {isChiikawa && <img src={CHIIKAWA_IMAGES[c.id]} className="w-16 h-16 object-contain" />}
                                        <div className="text-xs font-bold">{c.title}</div>
                                    </div>
                                ))}
                            </div>
                            <div className="text-sm space-y-4">
                                <p className="opacity-60 italic">「{userQuestion || '宇宙的當前指引'}」</p>
                                <p className="leading-relaxed text-justify">{aiResponse || '正在感應中...'}</p>
                            </div>
                        </div>
                        <button onClick={() => setIsShareMode(false)} className="mt-8 opacity-50 flex items-center gap-2"><Icon name="x" /> 返回</button>
                    </div>
                );
            }

            return (
                <div className={`min-h-screen ${themeStyles.bg} ${themeStyles.text} transition-colors duration-1000 pb-24`}>
                    <div className="fixed inset-0 overflow-hidden pointer-events-none opacity-20">
                        <div className={`absolute top-[-10%] left-[-10%] w-[80%] h-[40%] ${themeStyles.glow1} rounded-full blur-[120px] transition-colors duration-1000`} />
                        <div className={`absolute bottom-[-10%] right-[-10%] w-[80%] h-[40%] ${themeStyles.glow2} rounded-full blur-[120px] transition-colors duration-1000`} />
                    </div>

                    <div className="relative z-10 max-w-lg mx-auto px-6 py-8">
                        <header className="flex justify-between items-center mb-10">
                            <div className="flex items-center gap-2 cursor-pointer no-select" onClick={handleSecretClick}>
                                <div className="p-2 rounded-xl bg-white/20"><Icon name={isChiikawa ? "heart" : "sparkles"} className={isChiikawa ? "animate-pulse" : ""} /></div>
                                <h1 className="text-xl font-serif font-bold tracking-widest">{isChiikawa ? '阿爾克納 & Chiikawa' : '阿爾克那'}</h1>
                            </div>
                            <div className="flex gap-2">
                                {isChiikawa && <button onClick={returnToClassic} className="w-10 h-10 rounded-full flex items-center justify-center border bg-white/10"><Icon name="log-out" size={18} /></button>}
                                <button onClick={toggleTheme} className="w-10 h-10 rounded-full flex items-center justify-center border bg-white/10">
                                    <Icon name={isChiikawa ? "wand-2" : (theme === 'night' ? "moon" : "sun")} />
                                </button>
                            </div>
                        </header>

                        {activeTab === 'divination' && (
                            <div className="animate-in">
                                {gameState === 'idle' && (
                                    <div className="space-y-8">
                                        <h2 className="text-4xl font-serif font-bold leading-tight">{isChiikawa ? '嘿！現在\n想問什麼？' : '現在\n你想問什麼？'}</h2>
                                        <textarea value={userQuestion} onChange={e => setUserQuestion(e.target.value)} placeholder="在此輸入您的問題..." className={`w-full h-36 ${themeStyles.inputBg} border ${themeStyles.border} rounded-3xl p-6 focus:outline-none transition-all resize-none shadow-xl text-lg`} />
                                        <div className="flex gap-4">
                                            <button onClick={() => setSpreadType('one')} className={`flex-1 p-5 rounded-3xl border-2 transition-all group ${spreadType === 'one' ? (isChiikawa ? themeStyles.activeBtn : 'border-white bg-white/20') : 'opacity-40'}`}>
                                                <Icon name="compass" className="mx-auto mb-2" />
                                                <span className="text-sm font-bold block">一牌直覺</span>
                                            </button>
                                            <button onClick={() => setSpreadType('triangle')} className={`flex-1 p-5 rounded-3xl border-2 transition-all group ${spreadType === 'triangle' ? (isChiikawa ? themeStyles.activeBtn : 'border-white bg-white/20') : 'opacity-40'}`}>
                                                <Icon name="layout" className="mx-auto mb-2" />
                                                <span className="text-sm font-bold block">聖三角</span>
                                            </button>
                                        </div>
                                        <button onClick={drawCards} className={`w-full py-5 ${themeStyles.btnBg} rounded-full font-bold tracking-[0.3em] active:scale-95 transition-all text-lg shadow-2xl`}>啟動靈性感應</button>
                                    </div>
                                )}

                                {gameState === 'shuffling' && (
                                    <div className="flex flex-col items-center justify-center min-h-[50vh] space-y-8">
                                        <div className="relative w-32 h-48 animate-pulse">
                                            {[0,1,2].map(i => <div key={i} className="absolute inset-0 bg-white/10 border-2 border-white/20 rounded-xl" style={{ transform: `rotate(${i*10-10}deg)` }} />)}
                                        </div>
                                        <p className="text-xl font-serif italic animate-bounce">正在搜尋命運軌跡...</p>
                                    </div>
                                )}

                                {gameState === 'revealed' && (
                                    <div className="space-y-10 animate-in">
                                        <div className="flex flex-wrap justify-center gap-6">
                                            {selectedCards.map((c, i) => (
                                                <div key={i} className="flex flex-col items-center gap-3">
                                                    <div className={`relative w-40 h-64 rounded-xl p-1 bg-gradient-to-br from-white/80 to-white/20 shadow-2xl ${c.isReversed ? 'rotate-180' : ''}`}>
                                                        <div className={`w-full h-full ${themeStyles.cardBg} rounded-lg flex flex-col items-center justify-between p-3 relative overflow-hidden`}>
                                                            <div className="text-xs opacity-30">{c.numeral}</div>
                                                            <div className="flex-1 flex flex-col items-center justify-center space-y-3">
                                                                {isChiikawa ? <img src={CHIIKAWA_IMAGES[c.id]} className="w-32 h-32 object-contain" /> : <Icon name={c.id === 19 ? "sun" : (c.id === 18 ? "moon" : "star")} size={48} />}
                                                                <div className="text-center font-bold tracking-widest">{c.title}</div>
                                                            </div>
                                                            <div className="text-[10px] opacity-20 uppercase font-mono">{c.essence}</div>
                                                        </div>
                                                    </div>
                                                    <span className="text-[10px] uppercase opacity-60 font-bold">{c.isReversed ? '逆位' : '正位'}</span>
                                                </div>
                                            ))}
                                        </div>
                                        <div className="space-y-6">
                                            <div className={`${themeStyles.panelBg} rounded-[2rem] p-8 border ${themeStyles.border} shadow-2xl backdrop-blur-md`}>
                                                <div className="flex items-center gap-3 mb-4 opacity-60"><Icon name="brain-circuit" size={20} /><h3 className="font-bold">宇宙的溫暖啟示</h3></div>
                                                {isAiLoading ? <p className="animate-pulse py-4">正在讀取星圖訊息...</p> : <p className="leading-relaxed font-light text-justify whitespace-pre-wrap">{aiResponse || '靜候中...'}</p>}
                                            </div>
                                            {selectedCards.map((c, i) => (
                                                <div key={i} className={`p-6 rounded-[2rem] border ${themeStyles.border} ${themeStyles.panelBg} text-sm space-y-3`}>
                                                    <div className="flex justify-between items-center opacity-60 font-bold uppercase"><span className="flex items-center gap-2"><Icon name="info" size={14}/>{c.title}</span><span className="text-[10px]">{c.astrology}</span></div>
                                                    <p className="opacity-80">{c.essence}：{c.meaning}</p>
                                                    <p className="opacity-50 italic">{c.isReversed ? c.reversedInsight : c.uprightInsight}</p>
                                                </div>
                                            ))}
                                        </div>
                                        <div className="flex flex-col gap-4">
                                            <button onClick={() => setIsShareMode(true)} className={`${isChiikawa ? themeStyles.btnBg : 'bg-indigo-600 text-white'} py-6 rounded-full font-bold flex items-center justify-center gap-2 text-lg shadow-2xl border-2 border-white/20`}><Icon name="share-2" /> 生成這份祝福</button>
                                            <button onClick={resetGame} className="py-5 border-2 border-white/10 rounded-full opacity-60 font-bold flex items-center justify-center gap-2"><Icon name="refresh-cw" size={18} /> 重新占卜</button>
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}

                        <nav className={`fixed bottom-0 left-0 w-full ${themeStyles.navBg} backdrop-blur-2xl border-t ${themeStyles.border} px-8 py-5 flex justify-around items-center z-50`}>
                            <button onClick={() => setActiveTab('divination')} className={`flex flex-col items-center gap-1 transition-all ${activeTab === 'divination' ? 'opacity-100 scale-110' : 'opacity-40'}`}><Icon name="sparkles" /><span className="text-[10px] font-bold uppercase">占卜</span></button>
                            <button onClick={() => setActiveTab('guide')} className={`flex flex-col items-center gap-1 transition-all ${activeTab === 'guide' ? 'opacity-100 scale-110' : 'opacity-40'}`}><Icon name="book-open" /><span className="text-[10px] font-bold uppercase">指南</span></button>
                            <button onClick={() => setActiveTab('history')} className={`flex flex-col items-center gap-1 transition-all ${activeTab === 'history' ? 'opacity-100 scale-110' : 'opacity-40'}`}><Icon name="history" /><span className="text-[10px] font-bold uppercase">紀錄</span></button>
                        </nav>
                    </div>
                </div>
            );
        };

        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);
    </script>
</body>
</html>
